{"meta":{"title":"ChaosCoffee' blog","subtitle":null,"description":null,"author":"ChaoCofee","url":"https://chaoscoffee.github.io"},"pages":[{"title":"categories","date":"2018-07-27T06:39:54.000Z","updated":"2018-08-07T06:20:25.553Z","comments":true,"path":"categories/index.html","permalink":"https://chaoscoffee.github.io/categories/index.html","excerpt":"","text":""},{"title":"interview","date":"2018-07-27T06:39:54.000Z","updated":"2018-08-07T06:20:25.553Z","comments":true,"path":"categories/interview/index.html","permalink":"https://chaoscoffee.github.io/categories/interview/index.html","excerpt":"","text":""},{"title":"programmes","date":"2018-07-27T06:39:54.000Z","updated":"2018-08-07T06:20:25.553Z","comments":true,"path":"categories/programmes/index.html","permalink":"https://chaoscoffee.github.io/categories/programmes/index.html","excerpt":"","text":""},{"title":"tools","date":"2018-07-27T06:39:54.000Z","updated":"2018-08-07T06:20:25.553Z","comments":true,"path":"categories/tools/index.html","permalink":"https://chaoscoffee.github.io/categories/tools/index.html","excerpt":"","text":""}],"posts":[{"title":"Kubernetes-搭建本地环境","slug":"Kubernetes-搭建本地环境","date":"2018-08-07T05:27:45.000Z","updated":"2018-08-07T06:20:25.553Z","comments":false,"path":"2018/08/07/Kubernetes-搭建本地环境/","link":"","permalink":"https://chaoscoffee.github.io/2018/08/07/Kubernetes-搭建本地环境/","excerpt":"","text":"kubernetes 搭建本地环境 kubernetes 搭建本地环境 Chocolatey安装 更换镜像 安装virtualbox 添加所需要的库 更新yum缓存 安装virtualbox 安装 DKMS、更新内核 开启虚拟机虚化 安装 docker 安装kubectl 修改kubernetes.repo 安装kubectl、kubelet、kubeadm(所有节点) Minikube 下载安装 配置环境变量 启动 停止 删除 访问 Kubernetes部署 拉取镜像 发布服务 命令行模式 声明式模式(推荐) 查看Pod 查看service 查看日志 更新配置 销毁服务 客户端访问 查看master 问题 如何关闭防火墙？ minikube镜像下载不了？ 参考文献 Chocolatey安装安装 Chocolatey管理员身份运行cmd.exe 1@&quot;%SystemRoot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe&quot; -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command &quot;iex ((New-Object System.Net.WebClient).DownloadString(&apos;https://chocolatey.org/install.ps1&apos;))&quot; &amp;&amp; SET &quot;PATH=%PATH%;%ALLUSERSPROFILE%\\chocolatey\\bin&quot; choco choco upgrade chocolatey choco install kubernetes-cli 更换镜像[防火墙] $ cd /etc/sysconfig/network-scripts$ service network restart [更换yum] $ wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo $ yum makecache $ yum repolist $ yum repoinfo 安装virtualbox添加所需要的库 $ yum install wget$ cd /etc/yum.repos.d/$ wget http://download.virtualbox.org/virtualbox/rpm/rhel/virtualbox.repo virtualbox.repo内容如下: 1234567[virtualbox]name=Oracle Linux / RHEL / CentOS-$releasever / $basearch - VirtualBoxbaseurl=http://download.virtualbox.org/virtualbox/rpm/el/$releasever/$basearchenabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://www.virtualbox.org/download/oracle_vbox.asc 更新yum缓存 $ yum clean all $ yum makecache 安装virtualbox $ yum install VirtualBox-5.1 安装 DKMS、更新内核 $ yum -y install gcc make glibc kernel-headers kernel-devel dkms$ yum -y update kernel$ reboot 开启虚拟机虚化需要在BIOS里开启虚拟机虚化 安装 docker $ yum search docker$ yum install -y docker$ systemctl start docker 安装kubectl修改kubernetes.repo12345[kubernetes]name=Kubernetesbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64enabled=1gpgcheck=0 安装kubectl、kubelet、kubeadm(所有节点) kubelet: 运行在cluster所有节点上,负责启动POD和容器 kubeadm: 用于初始化cluster kubectl: kubectl是kubenetes命令行工具，通过kubectl可以部署和管理应用，查看各种资源，创建，删除和更新组件 $ yum install -y kubectl$ yum install -y kubelet$ yum install -y kubeadm MinikubeMinikube 是一个允许开发人员在本地使用和运行 Kubernetes 集群的工具 下载安装下载minikube[Linux] $ curl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v0.28.0/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/ [Windows] $ choco install minikube 配置环境变量MINIKUBE_HOME=D:\\kuberbnetesMINIKUBE_WANTREPORTERRORPROMPT=falseMINIKUBE_WANTUPDATENOTIFICATION=false 启动 $ minikube start –registry-mirror=https://registry.docker-cn.com–vm-driver=none //不用虚拟机 $ minikube start –vm-driver=virtualbox –registry-mirror=https://registry.docker-cn.com $ minikube start –vm-driver=hyperv –registry-mirror=https://registry.docker-cn.com Windowswindows10可以使用自带hyper-v参考启动配置: 12345$ minikube start --vm-driver=hyperv --hyperv-virtual-switch=minikube-Switch --registry-mirror=https://registry.docker-cn.com$ minikube start --vm-driver=&quot;hyperv&quot; --memory=4096 --cpus=4 --hyperv-virtual-switch=&quot;minikube-Switch&quot; --v=7 --alsologtostderr$ minikube start --vm-driver=&quot;hyperv&quot; --hyperv-virtual-switch=&quot;minikube-Switch&quot; --v=7 --alsologtostderr 作者配置(通过测试) $ minikube start –vm-driver “hyperv” –hyperv-virtual-switch “minikube-Switch” –v 9999 –alsologtostderr 停止 $ minikube stop 删除启动失败需要rm -rf 删除 ./minikube下的内容,再使用 $ minikube delete 最后重新执行启动命令 访问 $ minikube dashboard$ minikube service hello-node Kubernetes部署拉取镜像 $ docker pull chenliujin/defaultbackend:1.4$ docker tag chenliujin/defaultbackend:1.4 gcr.io/google_containers/defaultbackend:1.4 发布服务这里用NodePort对外提供服务 命令行模式 $kubectl run hello-minikube –image=k8s.gcr.io/echoserver:1.4 –port=8081$kubectl expose deployment hello-minikube –type=NodePort $ kubectl run –image=nginx nginx-app –port=80$ kubectl expose deployment nginx-app –port=80 –name=nginx-http –type=NodePort 设置镜像 $ kubectl set image deployment/hello-node hello-node=hello-node:v2 声明式模式(推荐)推荐使用 $ kubectl create -f nginx-rc.yaml 123456789101112131415161718apiVersion: v1 kind: ReplicationControllermetadata:name: nginx-rcspec:replicas: 2selector:app: nginxtemplate:metadata:labels:app: nginxspec:containers:- name: nginximage: nginxports:- containerPort: 80 $ kubectl create -f nginx-service.yaml 123456789101112apiVersion: v1 kind: Servicemetadata:name: nginx-servicespec:ClusterIP: Noneports:- port: 80targetPort: 80protocol: TCPselector:app: nginx 查看Pod查看默认的pod $ kubectl get pods 查看所有namespace的pod数据 $ kubectl get pods –all-namespaces -o wide请求部署的service$ curl $(minikube service hello-minikube –url) 查看service $ kubectl get services$ kubectl get service –all-namespaces 查看日志$ minikube logs 更新配置 $ kubectl replace -f rc-nginx.yaml 销毁服务 $ kubectl delete service nginx-service$ kubectl delete deployment nginx-pod$ kubectl delete rc nginx-service 客户端访问 $ curl ‘192.168.64.2:30716’$ minikube service nginx-http访问部署service$ minikube service hello-node 查看master $ kubectl cluster-info 问题如何关闭防火墙？关闭防火墙 $ systemctl stop firewalld //临时关闭$ systemctl disable firewalld //禁止开机启动$ Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.$ Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service. 访问: http://127.0.0.1:8001/ui minikube镜像下载不了？下载不了如何解决说明：由于GFW的原因下载不下来的，都可以到时速云去下载相应的镜像（只要把grc.io换成index.tenxcloud.com就可以了。或者用私用镜像仓库，tag之后上传到之后看到的镜像是自己私有镜像仓库的。 1$ sudo docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.1 &amp;&amp; sudo docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.1 k8s.gcr.io/pause-amd64:3.1 &amp;&amp; sudo /usr/bin/kubeadm init --config /var/lib/kubeadm.yaml --ignore-preflight-errors=DirAvailable--etc-kubernetes-manifests --ignore-preflight-errors=DirAvailable--data-minikube --ignore-preflight-errors=Port-10250 --ignore-preflight-errors=FileAvailable--etc-kubernetes-manifests-kube-scheduler.yaml --ignore-preflight-errors=FileAvailable--etc-kubernetes-manifests-kube-apiserver.yaml --ignore-preflight-errors=FileAvailable--etc-kubernetes-manifests-kube-controller-manager.yaml --ignore-preflight-errors=FileAvailable--etc-kubernetes-manifests-etcd.yaml --ignore-preflight-errors=Swap --ignore-preflight-errors=CRI 123$ minikube ssh$ docker pull registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0$ docker tag registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0 gcr.io/google_containers/pause-amd64:3.0 参考文献[参考] Kubernetes本地实验环境通过Minikube快速搭建一个本地的Kubernetes单节点环境","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://chaoscoffee.github.io/categories/kubernetes/"}],"tags":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://chaoscoffee.github.io/tags/kubernetes/"}],"keywords":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://chaoscoffee.github.io/categories/kubernetes/"}]},{"title":"Kubernetes-介绍","slug":"Kubernetes-介绍","date":"2018-08-07T03:09:04.000Z","updated":"2018-08-07T06:20:25.553Z","comments":false,"path":"2018/08/07/Kubernetes-介绍/","link":"","permalink":"https://chaoscoffee.github.io/2018/08/07/Kubernetes-介绍/","excerpt":"","text":"Kubernetes 介绍 Kubernetes 介绍 Kubernetes架构 架构图 节点 分层架构 使用Kubernetes能做什么？ Kubernetes不是什么？ Kubernetes架构架构图Kubernetes集群包含有节点代理kubelet和Master组件(APIs, scheduler, etc)，一切都基于分布式的存储系统。下面这张图是Kubernetes的架构图。 节点在这张系统架构图中，我们把服务分为运行在工作节点上的服务和组成集群级别控制板的服务。 Kubernetes节点有运行应用容器必备的服务，而这些都是受Master的控制。 每次个节点上当然都要运行Docker。Docker来负责所有具体的映像下载和容器运行。 Kubernetes主要由以下几个核心组件组成： etcd保存了整个集群的状态； apiserver提供了资源操作的唯一入口，并提供认证、授权、访问控制、API注册和发现等机制； controller manager负责维护集群的状态，比如故障检测、自动扩展、滚动更新等； scheduler负责资源的调度，按照预定的调度策略将Pod调度到相应的机器上； kubelet负责维护容器的生命周期，同时也负责Volume（CVI）和网络（CNI）的管理； Container runtime负责镜像管理以及Pod和容器的真正运行（CRI）； kube-proxy负责为Service提供cluster内部的服务发现和负载均衡； 除了核心组件，还有一些推荐的Add-ons： kube-dns负责为整个集群提供DNS服务 Ingress Controller为服务提供外网入口 Heapster提供资源监控 Dashboard提供GUI Federation提供跨可用区的集群 Fluentd-elasticsearch提供集群日志采集、存储与查询 分层架构Kubernetes设计理念和功能其实就是一个类似Linux的分层架构，如下图所示 核心层：Kubernetes最核心的功能，对外提供API构建高层的应用，对内提供插件式应用执行环境 应用层：部署（无状态应用、有状态应用、批处理任务、集群应用等）和路由（服务发现、DNS解析等） 管理层：系统度量（如基础设施、容器和网络的度量），自动化（如自动扩展、动态Provision等）以及策略管理（RBAC、Quota、PSP、NetworkPolicy等） 接口层：kubectl命令行工具、客户端SDK以及集群联邦 生态系统：在接口层之上的庞大容器集群管理调度的生态系统，可以划分为两个范畴 Kubernetes外部：日志、监控、配置管理、CI、CD、Workflow、FaaS、OTS应用、ChatOps等 Kubernetes内部：CRI、CNI、CVI、镜像仓库、Cloud Provider、集群自身的配置和管理等 使用Kubernetes能做什么？可以在物理或虚拟机的Kubernetes集群上运行容器化应用，Kubernetes能提供一个以“容器为中心的基础架构”，满足在生产环境中运行应用的一些常见需求，如： 多个进程（作为容器运行）协同工作。（Pod） 存储系统挂载 Distributing secrets 应用健康检测 应用实例的复制 Pod自动伸缩/扩展 Naming and discovering 负载均衡 滚动更新 资源监控 日志访问 调试应用程序 提供认证和授权 Kubernetes不是什么？Kubernetes并不是传统的PaaS（平台即服务）系统。 Kubernetes不限制支持应用的类型，不限制应用框架。限制受支持的语言runtimes (例如, Java, Python, Ruby)，满足12-factor applications 。不区分 “apps” 或者“services”。 Kubernetes支持不同负载应用，包括有状态、无状态、数据处理类型的应用。只要这个应用可以在容器里运行，那么就能很好的运行在Kubernetes上。 Kubernetes不提供中间件（如message buses）、数据处理框架（如Spark）、数据库(如Mysql)或者集群存储系统(如Ceph)作为内置服务。但这些应用都可以运行在Kubernetes上面。 Kubernetes不部署源码不编译应用。持续集成的 (CI)工作流方面，不同的用户有不同的需求和偏好的区域，因此，我们提供分层的 CI工作流，但并不定义它应该如何工作。 Kubernetes允许用户选择自己的日志、监控和报警系统。 Kubernetes不提供或授权一个全面的应用程序配置 语言/系统（例如，jsonnet）。 Kubernetes不提供任何机器配置、维护、管理或者自修复系统。 另一方面，大量的Paas系统都可以运行在Kubernetes上，比如Openshift、Deis、Gondor。可以构建自己的Paas平台，与自己选择的CI系统集成。 由于Kubernetes运行在应用级别而不是硬件级，因此提供了普通的Paas平台提供的一些通用功能，比如部署，扩展，负载均衡，日志，监控等。这些默认功能是可选的。 另外，Kubernetes不仅仅是一个“编排系统”；它消除了编排的需要。“编排”的定义是指执行一个预定的工作流：先执行A，之B，然C。相反，Kubernetes由一组独立的可组合控制进程组成。怎么样从A到C并不重要，达到目的就好。当然集中控制也是必不可少，方法更像排舞的过程。这使得系统更加易用、强大、弹性和可扩展。","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://chaoscoffee.github.io/categories/kubernetes/"}],"tags":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://chaoscoffee.github.io/tags/kubernetes/"}],"keywords":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://chaoscoffee.github.io/categories/kubernetes/"}]},{"title":"Markdown语法","slug":"Markdown语法","date":"2018-07-27T03:34:20.000Z","updated":"2018-08-07T06:20:25.553Z","comments":false,"path":"2018/07/27/Markdown语法/","link":"","permalink":"https://chaoscoffee.github.io/2018/07/27/Markdown语法/","excerpt":"","text":"欢迎使用Markdown编辑器写博客本Markdown编辑器使用StackEdit修改而来，用它写博客，将会带来全新的体验哦： Markdown和扩展Markdown简洁的语法 代码块高亮 图片链接和图片上传 LaTex数学公式 UML序列图和流程图 离线写博客 导入导出Markdown文件 丰富的快捷键 快捷键 加粗 Ctrl + B 斜体 Ctrl + I 引用 Ctrl + Q 插入链接 Ctrl + L 插入代码 Ctrl + K 插入图片 Ctrl + G 提升标题 Ctrl + H 有序列表 Ctrl + O 无序列表 Ctrl + U 横线 Ctrl + R 撤销 Ctrl + Z 重做 Ctrl + Y Markdown及扩展 Markdown 是一种轻量级标记语言，它允许人们使用易读易写的纯文本格式编写文档，然后转换成格式丰富的HTML页面。 —— [ 维基百科 ] 使用简单的符号标识不同的标题，将某些文字标记为粗体或者斜体，创建一个链接等，详细语法参考帮助？。 本编辑器支持 Markdown Extra , 扩展了很多好用的功能。具体请参考Github. 表格Markdown Extra 表格语法： 项目 价格 Computer $1600 Phone $12 Pipe $1 可以使用冒号来定义对齐方式： 项目 价格 数量 Computer 1600 元 5 Phone 12 元 12 Pipe 1 元 234 定义列表Markdown Extra 定义列表语法：项目１项目２: 定义 A: 定义 B 项目３: 定义 C : 定义 D &gt; 定义D内容 代码块代码块语法遵循标准markdown代码，例如：12345678910@requires_authorizationdef somefunc(param1='', param2=0): '''A docstring''' if param1 &gt; param2: # interesting print 'Greater' return (param2 - param1 + 1) or Noneclass SomeClass: pass&gt;&gt;&gt; message = '''interpreter... prompt''' 脚注生成一个脚注[^footnote]. [^footnote]: 这里是 脚注 的 内容. 目录用 [TOC]来生成目录： [TOC] 数学公式使用MathJax渲染LaTex 数学公式，详见math.stackexchange.com. 行内公式，数学公式为：$\\Gamma(n) = (n-1)!\\quad\\forall n\\in\\mathbb N$。 块级公式： $$ x = \\dfrac{-b \\pm \\sqrt{b^2 - 4ac}}{2a} $$ 更多LaTex语法请参考 这儿. UML 图:可以渲染序列图： 123张三-&gt;李四: 嘿，小四儿, 写博客了没?Note right of 李四: 李四愣了一下，说：李四--&gt;张三: 忙得吐血，哪有时间写。 或者流程图： 12345678st=&gt;start: 开始e=&gt;end: 结束op=&gt;operation: 我的操作cond=&gt;condition: 确认？st-&gt;op-&gt;condcond(yes)-&gt;econd(no)-&gt;op 关于 序列图 语法，参考 这儿, 关于 流程图 语法，参考 这儿. 离线写博客即使用户在没有网络的情况下，也可以通过本编辑器离线写博客（直接在曾经使用过的浏览器中输入write.blog.csdn.net/mdeditor即可。Markdown编辑器使用浏览器离线存储将内容保存在本地。 用户写博客的过程中，内容实时保存在浏览器缓存中，在用户关闭浏览器或者其它异常情况下，内容不会丢失。用户再次打开浏览器时，会显示上次用户正在编辑的没有发表的内容。 博客发表后，本地缓存将被删除。 用户可以选择 把正在写的博客保存到服务器草稿箱，即使换浏览器或者清除缓存，内容也不会丢失。 注意：虽然浏览器存储大部分时候都比较可靠，但为了您的数据安全，在联网后，请务必及时发表或者保存到服务器草稿箱。 浏览器兼容 目前，本编辑器对Chrome浏览器支持最为完整。建议大家使用较新版本的Chrome。 IE９以下不支持 IE９，１０，１１存在以下问题 不支持离线功能 IE9不支持文件导入导出 IE10不支持拖拽文件导入","categories":[{"name":"tools","slug":"tools","permalink":"https://chaoscoffee.github.io/categories/tools/"}],"tags":[{"name":"markdown","slug":"markdown","permalink":"https://chaoscoffee.github.io/tags/markdown/"}],"keywords":[{"name":"tools","slug":"tools","permalink":"https://chaoscoffee.github.io/categories/tools/"}]}]}