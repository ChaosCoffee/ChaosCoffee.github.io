<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta http-equiv="Cache-Control" content="no-siteapp"><meta http-equiv="Cache-Control" content="no-transform"><meta name="renderer" content="webkit|ie-comp|ie-stand"><meta name="apple-mobile-web-app-capable" content="ChaosCoffee&#39; blog"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="browsermode" content="application"><meta name="screen-orientation" content="portrait"><link rel="dns-prefetch" href="https://chaoscoffee.github.io"><meta name="robots" content="all"><meta name="google" content="all"><meta name="googlebot" content="all"><meta name="verify" content="all"><title>如何通过配置根据环境(条件)实例化Bean | ChaosCoffee&#39; blog</title><link rel="alternate" href="/atom.xml" title="ChaosCoffee&#39; blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/bootstrap.min.css?rev=01db7b9bef05ad753ff3280573311707"><link rel="stylesheet" href="/css/font-awesome.min.css?rev=7d7c67beb5a3ece63f0a947be957099b"><link rel="stylesheet" href="/css/style.css?rev=5e007e24b2eddf2cb1d77fa3b2664f4b"><div class="hide"><script type="text/javascript">var cnzz_protocol="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"))</script></div></head><!--[if lte IE 8]><style>
    html{ font-size: 1em }
</style><![endif]--><!--[if lte IE 9]><div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div><![endif]--><body><header class="main-header" style="background-image:url(/img/banner2.jpg)"><div class="main-header-box"><a class="header-avatar" href="/" title="ChaoCofee"><img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block"></a><div class="branding"><img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block"></div></div></header><nav class="main-navigation"><div class="container"><div class="row"><div class="col-sm-12"><div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav"><span class="sr-only"></span><i class="fa fa-bars"></i></span> <a class="navbar-brand" href="https://chaoscoffee.github.io">ChaosCoffee&#39; blog</a></div><div class="collapse navbar-collapse" id="main-menu"><ul class="menu"><li role="presentation" class="text-center"><a href="/"><i class="fa fa-home"></i> Home</a></li><li role="presentation" class="text-center"><a href="/categories/programmes/"><i class="fa fa-github"></i> Programmes</a></li><li role="presentation" class="text-center"><a href="/categories/tools/"><i class="fa fa-wrench"></i> Tools</a></li><li role="presentation" class="text-center"><a href="/categories/interview/"><i class="fa fa-user"></i> 求职面试</a></li><li role="presentation" class="text-center"><a href="/archives/"><i class="fa fa-calendar"></i> 时间轴</a></li></ul></div></div></div></div></nav><section class="content-wrap"><div class="container"><div class="row"><main class="col-md-8 main-content m-post"><p id="process"></p><article class="post"><div class="post-head"><h1 id="如何通过配置根据环境(条件)实例化Bean">如何通过配置根据环境(条件)实例化Bean</h1><div class="post-meta"><span class="categories-meta fa-wrap"><i class="fa fa-folder-open-o"></i> <a href="/categories/programmes">programmes</a></span><span class="fa-wrap"><i class="fa fa-tags"></i> <span class="tags-meta"><a href="/tags/java" title="java">java</a></span></span><span class="fa-wrap"><i class="fa fa-clock-o"></i> <span class="date-meta">2018/08/29</span></span></div></div><div class="post-body post-content"><h1 id="如何通过配置根据环境-条件-实例化Bean"><a href="#如何通过配置根据环境-条件-实例化Bean" class="headerlink" title="如何通过配置根据环境(条件)实例化Bean"></a>如何通过配置根据环境(条件)实例化Bean</h1><ul><li><a href="#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E6%A0%B9%E6%8D%AE%E7%8E%AF%E5%A2%83%E6%9D%A1%E4%BB%B6%E5%AE%9E%E4%BE%8B%E5%8C%96bean">如何通过配置根据环境(条件)实例化Bean</a><ul><li><a href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D">背景介绍</a></li><li><a href="#%E9%80%9A%E8%BF%87profile-%E5%AE%9E%E7%8E%B0">通过@Profile 实现</a><ul><li><a href="#profile-%E4%BB%8B%E7%BB%8D">@Profile 介绍</a></li><li><a href="#profile%E5%BA%94%E7%94%A8">@Profile应用</a></li></ul></li><li><a href="#%E9%80%9A%E8%BF%87conditionalonproperty-%E5%AE%9E%E7%8E%B0">通过@ConditionalOnProperty 实现</a><ul><li><a href="#conditionalonproperty%E4%BB%8B%E7%BB%8D">@ConditionalOnProperty介绍</a></li><li><a href="#conditionalonproperty%E5%BA%94%E7%94%A8">@ConditionalOnProperty应用</a></li></ul></li><li><a href="#%E9%80%9A%E8%BF%87%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0">通过工厂模式实现</a><ul><li><a href="#%E5%9C%BA%E6%99%AF%E4%BB%8B%E7%BB%8D">场景介绍</a></li><li><a href="#%E5%BA%94%E7%94%A8%E5%AE%9E%E7%8E%B0">应用实现</a></li></ul></li><li><a href="#%E5%9C%BA%E6%99%AF%E6%AF%94%E8%BE%83">场景比较</a></li></ul></li></ul><h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><p>如果需要不同的服务加载不同的配置,例如数据库配置，<code>MongoDB</code>或者<code>MySQL</code>等，启动的时候需要根据不同的条件来决定加载哪一个就可以，而不必要全部加载.</p><h2 id="通过-Profile-实现"><a href="#通过-Profile-实现" class="headerlink" title="通过@Profile 实现"></a>通过@Profile 实现</h2><h3 id="Profile-介绍"><a href="#Profile-介绍" class="headerlink" title="@Profile 介绍"></a>@Profile 介绍</h3><p><code>@Profile</code>注解可以联合<code>SpringBoot</code>可以根据配置文件里<code>application.yml</code> 里的属性 <code>spring.profiles.active=xxx</code> 配置来实现,<br>需要添加额外的profile文件。<br>规范来说，<code>@Profile</code>一般都是作为不同的环境来区分，比如开发，测试，生产环境来做区分，不适合单个环境作为具体配置。</p><p>下面是官方完整的API:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Conditional</span>(ProfileCondition.class)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Profile &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The set of profiles for which the annotated component should be registered.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String[] value();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Profile应用"><a href="#Profile应用" class="headerlink" title="@Profile应用"></a>@Profile应用</h3><ol><li>首先定义接口DatabaseOperationService</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DatabaseOperationService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List <span class="title">listByPage</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">---</span><br><span class="line"><span class="number">2</span>. 需要作为不同的数据库方式则实现此接口(具体实现代码忽略)</span><br><span class="line"></span><br><span class="line">``` java</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCServiceImpl</span> <span class="keyword">implements</span> <span class="title">DatabaseOperationService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Lists.newArrayList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoServiceImpl</span> <span class="keyword">implements</span> <span class="title">DatabaseOperationService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MongoServiceImpl</span><span class="params">(<span class="keyword">final</span> MongoTemplate mongoTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mongoTemplate = mongoTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Lists.newArrayList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ol start="3"><li>根据配置来实例需要的数据库加载方式</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataBaseConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * spring.profiles.active = &#123;&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"db"</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Environment env;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Autowired</span></span><br><span class="line">        JdbcConfiguration(<span class="keyword">final</span> Environment env) &#123;</span><br><span class="line">            <span class="keyword">this</span>.env = env;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">            dataSource.setDriverClassName(env.getProperty(<span class="string">"db.driver"</span>));</span><br><span class="line">            dataSource.setUrl(env.getProperty(<span class="string">"db.url"</span>));</span><br><span class="line">            <span class="comment">//用户名</span></span><br><span class="line">            dataSource.setUsername(env.getProperty(<span class="string">"db.username"</span>));</span><br><span class="line">            <span class="comment">//密码</span></span><br><span class="line">            dataSource.setPassword(env.getProperty(<span class="string">"db.password"</span>));</span><br><span class="line">            dataSource.setInitialSize(<span class="number">2</span>);</span><br><span class="line">            dataSource.setMaxActive(<span class="number">20</span>);</span><br><span class="line">            dataSource.setMinIdle(<span class="number">0</span>);</span><br><span class="line">            dataSource.setMaxWait(<span class="number">60000</span>);</span><br><span class="line">            dataSource.setValidationQuery(<span class="string">"SELECT 1"</span>);</span><br><span class="line">            dataSource.setTestOnBorrow(<span class="keyword">false</span>);</span><br><span class="line">            dataSource.setTestWhileIdle(<span class="keyword">true</span>);</span><br><span class="line">            dataSource.setPoolPreparedStatements(<span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">return</span> dataSource;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="meta">@Qualifier</span>(<span class="string">"jdbcService"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> DatabaseOperationService <span class="title">jdbcService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            JDBCServiceImpl jdbcService = <span class="keyword">new</span> JDBCServiceImpl();</span><br><span class="line">            <span class="keyword">return</span> jdbcService;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"mongo"</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Environment env;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Autowired</span></span><br><span class="line">        MongoConfiguration(<span class="keyword">final</span> Environment env) &#123;</span><br><span class="line">            <span class="keyword">this</span>.env = env;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="meta">@Qualifier</span>(<span class="string">"DatabaseOperationService"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> DatabaseOperationService <span class="title">mongoService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            MongoClientFactoryBean clientFactoryBean = <span class="keyword">new</span> MongoClientFactoryBean();</span><br><span class="line">            MongoCredential credential = MongoCredential.createScramSha1Credential(</span><br><span class="line">                    env.getProperty(<span class="string">"mongo.userName"</span>),</span><br><span class="line">                    env.getProperty(<span class="string">"mongo.dbName"</span>),</span><br><span class="line">                    env.getProperty(<span class="string">"mongo.password"</span>).toCharArray());</span><br><span class="line">            clientFactoryBean.setCredentials(<span class="keyword">new</span> MongoCredential[]&#123;credential&#125;);</span><br><span class="line">            List&lt;String&gt; urls = Splitter.on(<span class="string">","</span>).trimResults().splitToList(env.getProperty(<span class="string">"mongo.url"</span>));</span><br><span class="line">            ServerAddress[] sds = <span class="keyword">new</span> ServerAddress[urls.size()];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sds.length; i++) &#123;</span><br><span class="line">                List&lt;String&gt; adds = Splitter.on(<span class="string">":"</span>).trimResults().splitToList(urls.get(i));</span><br><span class="line">                InetSocketAddress address = <span class="keyword">new</span> InetSocketAddress(adds.get(<span class="number">0</span>), Integer.parseInt(adds.get(<span class="number">1</span>)));</span><br><span class="line">                sds[i] = <span class="keyword">new</span> ServerAddress(address);</span><br><span class="line">            &#125;</span><br><span class="line">            clientFactoryBean.setReplicaSetSeeds(sds);</span><br><span class="line">            MongoTemplate mongoTemplate = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                clientFactoryBean.afterPropertiesSet();</span><br><span class="line">                mongoTemplate =</span><br><span class="line">                        <span class="keyword">new</span> MongoTemplate(clientFactoryBean.getObject(),</span><br><span class="line">                                env.getProperty(<span class="string">"mongo.dbName"</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> MongoServiceImpl(mongoTemplate);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>配置文件<br><code>resource</code>目录下存在 <code>applicaiton-db.yml</code>或者 <code>applicaiton-mongo.yml</code>就能找到对应属性配置，同时在<code>application.yml</code>父级配置文件指定有效配置环境。</li></ol><hr><h2 id="通过-ConditionalOnProperty-实现"><a href="#通过-ConditionalOnProperty-实现" class="headerlink" title="通过@ConditionalOnProperty 实现"></a>通过@ConditionalOnProperty 实现</h2><h3 id="ConditionalOnProperty介绍"><a href="#ConditionalOnProperty介绍" class="headerlink" title="@ConditionalOnProperty介绍"></a>@ConditionalOnProperty介绍</h3><p>这种方式与上面一种比较起来，更为灵活,<code>@Profile</code>更多用于环境级别，<code>@ConditionalOnProperty</code>则可以控制<code>@Configuration</code>是否生效，<br>根据配置文件的不用来实现不同的加载bean.</p><ul><li><code>value</code> 获取对应property名称的值，与<code>name</code>不可同时使用</li><li><code>prefix</code> property名称的前缀，可有可无</li><li><code>name</code> property完整名称或部分名称（可与<code>prefix</code>组合使用，组成完整的property名称），与<code>value</code>不可同时使用</li><li><code>havingValue</code> 可与<code>name</code>组合使用，比较获取到的属性值与<code>havingValue</code>给定的值是否相同，相同才加载配置</li><li><code>matchIfMissing</code> 缺少该property时是否可以加载。如果为true，没有该property也会正常加载;反之报错</li><li><code>relaxedNames</code> 松散匹配，可以理解为多变量的变种</li></ul><p>下面是官方完整的API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(&#123; ElementType.TYPE, ElementType.METHOD &#125;)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Conditional</span>(OnPropertyCondition.class)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ConditionalOnProperty &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Alias for &#123;<span class="doctag">@link</span> #name()&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the names</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * A prefix that should be applied to each property. The prefix automatically ends</span></span><br><span class="line"><span class="comment">	 * with a dot if not specified.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the prefix</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">prefix</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The name of the properties to test. If a prefix has been defined, it is applied to</span></span><br><span class="line"><span class="comment">	 * compute the full key of each property. For instance if the prefix is</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@code</span> app.config&#125; and one value is &#123;<span class="doctag">@code</span> my-value&#125;, the fully key would be</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@code</span> app.config.my-value&#125;</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;</span></span><br><span class="line"><span class="comment">	 * Use the dashed notation to specify each property, that is all lower case with a "-"</span></span><br><span class="line"><span class="comment">	 * to separate words (e.g. &#123;<span class="doctag">@code</span> my-long-property&#125;).</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the names</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String[] name() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The string representation of the expected value for the properties. If not</span></span><br><span class="line"><span class="comment">	 * specified, the property must &lt;strong&gt;not&lt;/strong&gt; be equals to &#123;<span class="doctag">@code</span> false&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the expected value</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">havingValue</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Specify if the condition should match if the property is not set. Defaults to</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@code</span> false&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> if should match if the property is missing</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">matchIfMissing</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * If relaxed names should be checked. Defaults to &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> if relaxed names are used</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">relaxedNames</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ConditionalOnProperty应用"><a href="#ConditionalOnProperty应用" class="headerlink" title="@ConditionalOnProperty应用"></a>@ConditionalOnProperty应用</h3><ol><li>添加注解@ConditionalOnProperty<br>为了方便，仍然使用以上代码，只需要将这部分代码替换为下面的：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">修改前:  </span><br><span class="line"><span class="meta">@Profile</span>(<span class="string">"db"</span>)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">修改后:</span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(value = &#123;<span class="string">"database.spi"</span>&#125;,havingValue = <span class="string">"db"</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ol start="2"><li>添加配置<br>在<code>application.yml</code>里指定<code>database.spi=xxx</code></li></ol><h2 id="通过工厂模式实现"><a href="#通过工厂模式实现" class="headerlink" title="通过工厂模式实现"></a>通过工厂模式实现</h2><p>以上的两种方式都可以实现我们的切换服务的需求，但是不通过直接注解，代码实现也能实现,下面让我们试试吧.</p><h3 id="场景介绍"><a href="#场景介绍" class="headerlink" title="场景介绍"></a>场景介绍</h3><p>一般说来，<br>有调用不同的厂商发送短信，例如联通，移动，电信这些不同的运营商，可能还会中间经过不同的代理商，这个就不细谈了。<br>还有使用不同的文件服务器上传服务，例如阿里的oss，亚马逊的aws之类的。<br>还有金融不同的支付接口，阿里，中金，连连之类的。<br>原来只在一个的基础上没有问题，按照流程到哪步进行开发，这样以后需要切换一个服务就得加很多不同的调用代码。<br>所以针对这个情况，我们希望可以有个公共部分替我们管理，而我们只需要写好各自的真正调用部分的代码就行了。<br>这时候工厂模式就派上用场了，预先在生产好产品或者服务，调用方只需要根据自己的需要去拿就可以了。</p><h3 id="应用实现"><a href="#应用实现" class="headerlink" title="应用实现"></a>应用实现</h3><ol><li>定义数据库枚举类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> DatabaseEnum &#123;</span><br><span class="line">    MYSQL(<span class="string">"msql"</span>),</span><br><span class="line">    MONGONDB(<span class="string">"mongoDb"</span>),</span><br><span class="line">    UNACCEPT(<span class="string">"unaccept"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    DatabaseEnum(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DatabaseEnum <span class="title">getAcceptApplicationNameEnum</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (DatabaseEnum databaseEnum : DatabaseEnum.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (databaseEnum.name.equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> databaseEnum;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> UNACCEPT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ol start="2"><li>增加接口方法<br>这里其实是为了下面工厂类更好的找到Bean,或者不用接口增加方法，给实例Bean设置别名和配置文件保持一致即可。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DatabaseOperationService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List <span class="title">listByPage</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">DatabaseEnum <span class="title">code</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ol start="3"><li>工厂类<br>可能注意这里用了一个<code>map</code>存储，这里存储的是所有的实例，运行的时候根据配置来调用不同的实现类来完成任务。<br>里面定义了一些方法，并不是所有都需要用到，需要哪个加载Bean,可以通过<code>getBean()</code>来获取.<br>并且从配置文件里实现了两种方式 <code>database.type=mongoDb,mysql</code>或者<code>database.type[0]=mongoDb</code>,<code>database.type[1]=mysql</code><br>根据喜好来选择吧,这里用的是第二种。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseFactory</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@Value("$&#123;database.type&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> String acceptType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AppsType types;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;DatabaseEnum, DatabaseOperationService&gt; beanMap;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        Map&lt;String, DatabaseOperationService&gt; map = applicationContext.getBeansOfType(DatabaseOperationService.class);</span><br><span class="line">        beanMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.forEach((k, v) -&gt; beanMap.put(v.code(), v));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据不同的类型获取bean</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T extends DatabaseOperationService&gt; <span class="function">T <span class="title">getBean</span><span class="params">(DatabaseEnum code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T) beanMap.get(code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据配置文件来获取bean</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T extends DatabaseOperationService&gt; <span class="function">T <span class="title">getBean</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getBean(DatabaseEnum.getAcceptApplicationNameEnum(code));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据单一配置文件来获取bean</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T extends DatabaseOperationService&gt; <span class="function">T <span class="title">getBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getBean(acceptType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据配置文件来获取beans</span></span><br><span class="line"><span class="comment">     * database.type=mongoDb,mysql...</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getBeans0</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(acceptType.split(<span class="string">","</span>))</span><br><span class="line">                .stream()</span><br><span class="line">                .distinct()</span><br><span class="line">                .map(v -&gt; getBean(v))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据配置文件来获取beans</span></span><br><span class="line"><span class="comment">     * database.type[0]=mysql</span></span><br><span class="line"><span class="comment">     * ...</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getBeans</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> types.getType()</span><br><span class="line">                .stream()</span><br><span class="line">                .distinct()</span><br><span class="line">                .map(v -&gt; getBean(v))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnableConfigurationProperties</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"database.type"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AppsType</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> List&lt;DatabaseEnum&gt; type;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            types = <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AppsType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.type = Lists.newArrayList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;DatabaseEnum&gt; <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> type;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(List&lt;DatabaseEnum&gt; type)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.type = type;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ol start="4"><li>对外执行类Executor</li></ol><p>这个执行器可以自己定义,这里可以执行两个数据库的内容，然后返回数据.<br>其实这个Executor对外服务的话，假设一个服务不通，根据某种策略，切换另一个服务，这里只是简单演示，并不深究了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseExecutor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DatabaseFactory databaseFactory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行列表入口</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> apps</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(List&lt;String&gt; apps)</span> </span>&#123;</span><br><span class="line">        List&lt;DatabaseOperationService&gt; services = databaseFactory.getBeans();</span><br><span class="line">        services.forEach(service -&gt; service.listByPage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>添加配置文件属性<br>配置如下:</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">database:</span></span><br><span class="line">  <span class="string">type[0]:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="string">type[1]:</span> <span class="string">mongoDb</span></span><br><span class="line"><span class="comment">#或者 </span></span><br><span class="line"><span class="attr">database:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">mysql</span></span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line"><span class="attr">database:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">mysql,mongoDb</span></span><br></pre></td></tr></table></figure><ol start="6"><li>调用方调用<br>注入<code>DatabaseExecutor</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationServiceImpl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DatabaseExecutor databaseExecutor;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listByPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        databaseExecutor.execute(Lists.newArrayList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="场景比较"><a href="#场景比较" class="headerlink" title="场景比较"></a>场景比较</h2><ul><li>第一种方式比较简单，优点简洁明了，不需要多余配置，不同属性增加配置文件里就行了，缺点只能配置一个<code>Configuration</code>，假如遇见多环境，则增加配置文件等会与实际运维等冲突，有些公司配置文件并不由开发人员管理.</li><li>第二种方式优点与上面相似，方便快捷, 开发工作量小，可以根据一个配置文件就能确定加载类，而且可以控制加载多个配置</li><li>第三种方式其实算是对第二种方式的具体实现，但过程中增加一个<code>DatabaseExecutor</code>,可以多实例运行，扩展性比第一种好，由于不依赖其他，可以手动编写个性化设置.</li></ul></div><div class="post-footer"><div>转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">ChaosCoffee</a></div><div></div></div></article><div class="article-nav prev-next-wrap clearfix"><a href="/2018/08/28/Markdown语法高亮-1/" class="next-post btn btn-default" title="Markdown语法高亮"><span class="hidden-lg">下一篇</span> <span class="hidden-xs">Markdown语法高亮</span><i class="fa fa-angle-right fa-fw"></i></a></div></main><aside id="article-toc" role="navigation" class="col-md-4"><div class="widget"><h3 class="title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#如何通过配置根据环境-条件-实例化Bean"><span class="toc-text">如何通过配置根据环境(条件)实例化Bean</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#背景介绍"><span class="toc-text">背景介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过-Profile-实现"><span class="toc-text">通过@Profile 实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Profile-介绍"><span class="toc-text">@Profile 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Profile应用"><span class="toc-text">@Profile应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过-ConditionalOnProperty-实现"><span class="toc-text">通过@ConditionalOnProperty 实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ConditionalOnProperty介绍"><span class="toc-text">@ConditionalOnProperty介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConditionalOnProperty应用"><span class="toc-text">@ConditionalOnProperty应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过工厂模式实现"><span class="toc-text">通过工厂模式实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#场景介绍"><span class="toc-text">场景介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用实现"><span class="toc-text">应用实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#场景比较"><span class="toc-text">场景比较</span></a></li></ol></li></ol></div></aside></div></div></section><footer class="main-footer"><div class="container"><div class="row"><div style="text-align:center"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">Total&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;views. 您是本站的第<span id="busuanzi_value_site_uv"></span>个小伙伴&nbsp;|<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> &nbsp;Hits</div></div></div></footer><a id="back-to-top" class="icon-btn hide"><i class="fa fa-chevron-up"></i></a><div class="copyright"><div class="container"><div class="row"><div class="col-sm-12"><span>Copyright &copy; 2017</span> | <span>Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a></span> | <span>Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a></span></div></div></div></div><script src="/js/app.js?rev=26a1b6fecd389c0121b7027a299aa7c0"></script></body></html>